<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv='Content-type' content='text/html; charset=utf-8'>
    <title>Conways Game of Life</title>
    <style>
      .cell {width: 15px;height: 15px;}
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.8.0/react.js"></script>
    <script src="
https://cdnjs.cloudflare.com/ajax/libs/react/0.8.0/JSXTransformer.js"></script>
    <script type="text/jsx">
      /**
       * @jsx React.DOM
       */
      var gridColors = ["#fff", "#000", "#ccc", "#99f"];
      var weights = [10, 2, 10, 10];
      var weightSum = weights.reduce(function(prev, curr) { return prev + curr; })
      var weightedColors=[];
      var currentColor=0;
       
      while (currentColor<weights.length){
          for (var i=0; i<weights[currentColor]; i++)
              weightedColors[weightedColors.length]=currentColor;
          currentColor++;
      }

      var Cell = React.createClass({
        onClick: function() {
          this.props.onClick();
        },

        render: function() {
            return <td className="cell" onClick={this.onClick} style={{'background-color': gridColors[this.props.alive]}} />;
        }
      });

      var Grid = React.createClass({
        onClick: function(x,y) {
          self = this;
          return function(){
            self.props.onClick(x, y)
          }
        },

        render: function() {
          oc = this.onClick;
          var list_of_rows = this.props.grid.map(function(row, y){
            var row_of_cells = row.map(function(alive, x) {
              return <Cell alive={alive} x={x} y={y} key={""+y+","+x} onClick={oc(x, y)}/>;
            });
            return <tr key={y}>{row_of_cells}</tr>
          })

          return <table><tbody>{list_of_rows}</tbody></table>;
        }
      });

      var invertGridPoint = function(x, y, grid) {
        return grid.map(function(val, old_y) {
          if (old_y !== y) {
           return val;
         } else {
           return val.map(function(val, old_x) {
             if (old_x !== x) {
               return val;
             } else {
                return (val + 1) % gridColors.length;
             }
           });
         }
        });
      };


      var ClickableGrid = React.createClass({
         getInitialState: function(){
           return {
             grid: this.props.startingGrid,
           };
         },
                  
         onClick: function(x, y){
           new_grid = invertGridPoint(x,y,this.state.grid);
           this.setState({grid: new_grid});
         },

         render: function(){
           return <div>
                   <Grid grid={this.state.grid} onClick={this.onClick}/>
                   </div>
          }
        })

      function getRandomInt(max) {
        return Math.floor(Math.random() * max);
      }

      small = [];

      var breedte = 50;
      var hoogte = 18;
      for(var y = 0; y < hoogte; y++) {
        small[y] = []
        for(var x = 0; x < breedte; x++){
          var rnd = getRandomInt(weightSum);
          small[y][x] = weightedColors[rnd]
        }
      }

      React.renderComponent(
        <ClickableGrid startingGrid={small} />,
        document.getElementById('container')
      );
    </script>
  </body>
</html>
